I"Ü<h2 id="update-assembly-video-available">Update: Assembly Video Available!</h2>

<p><a href="https://www.youtube.com/channel/UCoLccjs6jbHa4soeYDgbKTg">Modern Classic</a> has uploaded an <a href="https://www.youtube.com/watch?v=Mzu5asr0b1o">XT-IDE rev 4 kit assembly video</a> to YouTube! His process is basically the same sequence we use to assemble XT-IDEs in the shop. The video covers all of the basics and provides a more visually-oriented guide than any of the forum posts or writeups.</p>

<h2 id="quick-links">Quick Links</h2>

<ul>
  <li><a href="https://github.com/glitchwrks/xt_ide/">GitHub Repository</a></li>
  <li><a href="http://www.vcfed.org/forum/showthread.php?59185">Build Thread on VC Forums</a></li>
  <li><a href="https://www.tindie.com/products/10584/">Bare Boards on Tindie</a></li>
  <li><a href="https://www.tindie.com/products/10655/">Parts Kits on Tindie</a></li>
  <li><a href="https://www.tindie.com/products/10586/">Assembled Boards on Tindie</a></li>
</ul>

<h2 id="changes">Changes</h2>

<p>The XT-IDE rev 4 board is an improvement on the <a href="/2016/07/06/xt-ide-rev3">Glitch Works XT-IDE rev 3</a>, which itself is a descendant of the original XT-IDE project from Jeff Leyda/Hargle and N8VEM/vintage-computer.com. As with the original project, the board is completely open source, licensed under the <a href="https://www.gnu.org/licenses/gpl-3.0.en.html">GNU GPL v3.0</a>. It was designed with <a href="http://kicad-pcb.org/">KiCad</a>, a completely open source cross-platform EDA package. Here‚Äôs a 3D rendering of the prototype from KiCad:</p>

<div class="center">
  <a href="/images/xtide/xt_ide_rev4/3d_rendering.jpg"><img src="/images/xtide/xt_ide_rev4/scaled/3d_rendering.jpg" alt="3D Rendering of Prototype" /></a>
</div>

<p>The main changes are as follows:</p>

<ul>
  <li>Better/more consistent parts numbering (U1 is top left, U2 is to the right, etc.)</li>
  <li>Thicker/more consistent silkscreen (some board houses produced illegible/broken silkscreen on some labels and symbols)</li>
  <li>Larger pads around some of the jumper headers</li>
  <li>Better pin 1 identification for ICs</li>
  <li>Rotate IC part number text (e.g. 74LS688) to match typical orientation on ICs</li>
  <li>Change bypass cap values to match parts kit (changed to C instead of a uF value)</li>
  <li>Additional test points for <a href="/2017/02/03/slot-8-support">Slot 8 Support</a> installation</li>
</ul>

<p>The above changes make assembly easier, especially for kit builders. The Slot 8 Support test points keep jumper wires short, and route <code>*CARDSEL</code> through SW1 position 8.</p>

<h2 id="latch-readwrite-timing">Latch Read/Write Timing</h2>

<p><a href="https://www.retrotronics.org/">Alan Hightower</a> ran into me at <a href="http://vcfed.org/wp/festivals/vintage-computer-festival-east/">VCF East 2017</a> and described a race condition he encountered with the XT-IDE rev 3 while he was developing the <a href="https://www.retrotronics.org/home-page/netpi-ide/">NetPi-IDE</a>. The basic issue was that the IDE device‚Äôs read/write lines were being de-asserted before the latch interface on IDE reads, and data from the latch interface wasn‚Äôt being held long enough on IDE writes. This issue seems to only occur with very fast IDE devices. During the prototyping phase, I hooked up the HP 1650A logic analyzer and took a look at what was going on:</p>

<div class="center">
  <a href="/images/xtide/xt_ide_rev4/analyzer_setup.jpg"><img src="/images/xtide/xt_ide_rev4/scaled/analyzer_setup.jpg" alt="HP 1650A setup" /></a>
  <a href="/images/xtide/xt_ide_rev4/analyzer_leads.jpg"><img src="/images/xtide/xt_ide_rev4/scaled/analyzer_leads.jpg" alt="Test leads connected to prototype XT-IDE rev 4" /></a>
</div>

<p>With the analyzer hooked up, I was able to capture read and write timing. The following image shows various read line timing:</p>

<div class="center">
  <img src="/images/xtide/xt_ide_rev4/read_delay.gif" alt="Read timing" />
</div>

<p><code>IORISA</code> is the <code>*IOR</code> strobe essentially directly off of the ISA bus. <code>IORIDE</code> is the same signal after passing through four sections of a 74LS04 inverter, this adds around 20 nS of gate delay. <code>HI RD</code> is the latch strobe to U1, the high byte read latch that stores the upper 8 bits of the ATA device‚Äôs output data during a read, so we can grab it later. As seen in the timing diagram, where <code>HI RD</code> used to lag <code>IORISA</code> by 10 nS, it now leads by 10 nS due to the 20 nS delay chain. This means the latch stores its value 10 nS before the ATA device stops outputting valid data, which is well within the spec for even the 74LS573 latch (the kits typically come with 74F573 latches, because I have a supply of them).</p>

<p>Here‚Äôs the various write signal timings:</p>

<div class="center">
  <img src="/images/xtide/xt_ide_rev4/write_delay.gif" alt="Write timing" />
</div>

<p><code>IOWIDE</code> is the <code>*IOW</code> signal essentially directly off of the ISA bus. <code>HI WR</code> is the latch strobe for storing the upper byte before doing a 16-bit write to the ATA device. <code>HI OUT</code> is the delayed ‚Äú2 signal‚Äù from the XT-IDE logic (I‚Äôve since relabeled it <code>*HI_BYTE_OUT</code> on the schematic, which I think is clearer). It was delayed by running it through two sections of a 74LS04 inverter and one section of a 74LS32 OR gate, with one input of the OR gate tied to ground. As seen in the timing diagram, <code>*HI_BYTE_OUT</code> now de-asserts 10 nS after the <code>*IOW</code> line, ensuring that data is presented to the ATA device for 10 nS past the end of the ATA write operation. I‚Äôm not sure if many (or any) ATA devices are this picky about the timing, but correcting it at the same time as making other rev 4 changes didn‚Äôt require any spare gates.</p>

<p>All of this was breadboarded on an old XT-IDE rev 3 prototype board from the initial rev 3 design, with a 74LS04 dead-bugged onto the circuit board and wired in. I made the read delay chain modifications and had some more prototypes run. Alan has one of them, which he used to confirm that the read timing was fixed. I modified a second with a socket for the 74LS04 so that I could test faster devices, as well as adding in the high byte output delay. I tested 74S04, 74LS04, 7404, and 74F04 devices, to make sure that whatever got stuck in there by someone assembling an XT-IDE would provide sufficient delay. All provided sufficient delay, the 7404 was the only measurable difference, providing around 25 nS instead of 20 nS, which is fine.</p>

<h2 id="production-boards">Production Boards</h2>

<p>With the race conditions worked out, it was time to run production boards! The XT-IDE rev 4 boards were produced with the same specs as the XT-IDE rev 3 boards. Here‚Äôs a bare production board:</p>

<div class="center">
  <a href="/images/xtide/xt_ide_rev4/rev4_bare.jpg"><img src="/images/xtide/xt_ide_rev4/scaled/rev4_bare.jpg" alt="Bare rev 4 production board" /></a>
</div>

<p>The boards were built up, tested, and works fine! In addition to building up a plain XT-IDE rev 4 board, I installed a Slot 8 Support module. The new test points make the Slot 8 Support even easier to install:</p>

<div class="center">
  <a href="/images/xtide/xt_ide_rev4/rev4_front.jpg"><img src="/images/xtide/xt_ide_rev4/scaled/rev4_front.jpg" alt="XT-IDE rev 4 assembled" /></a>
  <a href="/images/xtide/xt_ide_rev4/slot_8_support.jpg"><img src="/images/xtide/xt_ide_rev4/scaled/slot_8_support.jpg" alt="Slot 8 Support installed" /></a>
</div>

<p>So, that‚Äôs the fourth revision of the Hargle/N8VEM XT-IDE! See the links at the top for the GitHub repository, build thread, and Tindie store links! Or, check out the <a href="https://www.tindie.com/stores/glitchwrks/">Glitch Works Tindie Store</a> for XT-IDE related listings and other projects.</p>

<p class="center">
    <script language="javascript" src="https://services.glitchworks.net/counters/xt_ide_rev4"></script> hard drives replaced
</p>

:ET